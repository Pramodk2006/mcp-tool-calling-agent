# MCP Tool-Calling Agent Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              USER INTERFACE (Frontend)                         │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   Query Input   │  │  PDF Upload     │  │  Results View   │                │
│  │                 │  │                 │  │                 │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    │
                            HTTP/REST API
                                    │
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           FASTAPI BACKEND                                      │
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   /agent        │  │  /upload-pdf    │  │   /tools        │                │
│  │   /health       │  │  /uploads       │  │   /docs         │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    │
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              MCP AGENT CORE                                    │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        AGENT ORCHESTRATOR                              │   │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │   │
│  │  │  Query Analysis │  │ Multi-step      │  │  Answer         │        │   │
│  │  │                 │  │ Execution       │  │  Generation     │        │   │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘        │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                    │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        LLM INTERFACE                                   │   │
│  │  ┌─────────────────┐  ┌─────────────────┐                              │   │
│  │  │  Tool Selection │  │  Answer Gen     │                              │   │
│  │  │  (GPT/Fallback) │  │  (GPT/Fallback) │                              │   │
│  │  └─────────────────┘  └─────────────────┘                              │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                    │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        TOOL MANAGER                                     │   │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │   │
│  │  │  Tool Registry  │  │  Validation     │  │  Execution      │        │   │
│  │  │                 │  │                 │  │                 │        │   │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘        │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    │
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                TOOL LAYER                                      │
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   Search Tool   │  │ Calculator Tool │  │PDF Summarizer   │                │
│  │                 │  │                 │  │                 │                │
│  │ DuckDuckGo API  │  │ Safe Math Eval  │  │ PyPDF2 + LLM    │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │  Weather Tool   │  │    RAG Tool     │  │  System Tool    │                │
│  │                 │  │                 │  │                 │                │
│  │ Open-Meteo API  │  │FAISS + Sentence │  │ psutil + OS     │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    │
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           EXTERNAL SERVICES                                    │
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   OpenAI API    │  │ DuckDuckGo API  │  │ Open-Meteo API  │                │
│  │                 │  │                 │  │                 │                │
│  │ GPT-3.5/4       │  │ Web Search      │  │ Weather Data    │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
└─────────────────────────────────────────────────────────────────────────────────┘

EXECUTION FLOW:
1. User submits query via frontend
2. FastAPI backend receives request
3. Agent analyzes query and selects appropriate tools
4. Tool Manager validates and executes selected tools
5. Results are aggregated and fed back to LLM for final answer generation  
6. Structured response returned to frontend with steps and raw outputs
7. Frontend displays results with collapsible sections for detailed views